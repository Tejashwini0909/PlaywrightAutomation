name: ClickUp Test Notifications

on:
  workflow_run:
    workflows:
      - Playwright Tool Validation
      - Playwright Sanity Test Suite
    types:
      - completed

permissions:
  actions: read
  contents: read

jobs:
  notify-clickup:
    runs-on: ubuntu-latest
    if: ${{ contains(fromJson('["success","failure","timed_out"]'), github.event.workflow_run.conclusion) }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download junit artifact
        uses: actions/download-artifact@v4
        with:
          run-id: ${{ github.event.workflow_run.id }}
          name: junit-report
          path: artifacts

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Send ClickUp notification
        run: node clickup-automation/send-clickup-report.js
        env:
          CLICKUP_API_TOKEN: ${{ secrets.CLICKUP_API_TOKEN }}
          CLICKUP_TEAM_ID: ${{ secrets.CLICKUP_TEAM_ID }}
          CLICKUP_ROOM_ID: ${{ secrets.CLICKUP_ROOM_ID }}
          JUNIT_PATH: artifacts/junit-report/junit-report.xml
          RUN_CONCLUSION: ${{ github.event.workflow_run.conclusion }}
          GITHUB_WORKFLOW_NAME: ${{ github.event.workflow_run.name }}
          GITHUB_RUN_ID: ${{ github.event.workflow_run.id }}
          GITHUB_RUN_NUMBER: ${{ github.event.workflow_run.run_number }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_SERVER_URL: ${{ github.server_url }}

