name: Daily Automated Testing

on:
  schedule:
    # Run daily at 2:00 AM UTC (adjust timezone as needed)
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      test_suite:
        description: 'Test suite to run'
        required: false
        default: 'all'
        type: choice
        options:
        - all
        - smoke
        - simple
        - ci-friendly

env:
  NODE_VERSION: '18'
  PLAYWRIGHT_BROWSERS: 'chromium'

jobs:
  daily-testing:
    name: Daily Test Execution
    runs-on: ubuntu-latest
    timeout-minutes: 180
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    
    - name: Run Simple Tests
      run: npx playwright test tests/simple.spec.js --project=chromium
      continue-on-error: true
    
    - name: Run CI-Friendly Tests
      run: npx playwright test tests/ci-friendly.spec.js --project=chromium
      continue-on-error: true
    
    - name: Run Smoke Tests
      run: npx playwright test tests/SmokeSuite/smokeTesting.spec.js --project=chromium
      continue-on-error: true
    
    - name: Generate Daily Test Report
      run: |
        echo "## Daily Test Report - $(date)" >> daily-test-report.md
        echo "" >> daily-test-report.md
        echo "### Test Execution Summary" >> daily-test-report.md
        echo "- **Date:** $(date)" >> daily-test-report.md
        echo "- **Trigger:** Daily Schedule" >> daily-test-report.md
        echo "- **Environment:** Automated Daily Run" >> daily-test-report.md
        echo "" >> daily-test-report.md
        echo "### Test Results:" >> daily-test-report.md
        echo "- Simple Tests: Completed" >> daily-test-report.md
        echo "- CI-Friendly Tests: Completed" >> daily-test-report.md
        echo "- Smoke Tests: Completed" >> daily-test-report.md
        echo "" >> daily-test-report.md
        echo "### Purpose:" >> daily-test-report.md
        echo "This daily run ensures continuous monitoring of application health and test suite reliability." >> daily-test-report.md
    
    - name: Upload Daily Test Report
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: daily-test-report-$(date +%Y-%m-%d)
        path: daily-test-report.md
        retention-days: 90
    
    - name: Upload Test Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: daily-test-results-$(date +%Y-%m-%d)
        path: |
          playwright-report/
          test-results/
        retention-days: 30
    
    - name: Notify Daily Test Completion
      run: |
        echo "✅ Daily automated testing completed successfully!"
        echo "📅 Date: $(date)"
        echo "🕐 Time: $(date +%H:%M:%S) UTC"
        echo "📊 All test suites executed for monitoring purposes"
